# Отчёт по лабораторной работе по DevOps №2
## Содержание:
- [Установка Docker на Ubuntu](#установка-docker-на-ubuntu)
- ["Bad" Dockerfile](#bad-dockerfile)
- ["Good" Dockerfile](#good-dockerfile)
- ["Bad Guys" в контейнерах](#bad-guys-в-контейнерах)

## Установка Docker на Ubuntu
Ниже описываем все шаги, как мы скачивали Docker:

`sudo apt update` - обновляем списки пакетов из репозиториев

`sudo apt install apt-transport-https ca-certificates curl software-properties-common` - установливаем пакеты, которые необходимы для работы пакетного менеджера apt по протоколу HTTPS

`curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -` - добавляем GPG-ключ репозитория Docker

`sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable"` - добавляем репозиторий Docker

`sudo apt update` - ещё раз обновляем пакеты

`apt-cache policy docker-ce` - переключаемся в репозиторий Docker, чтобы его установить

`sudo apt install docker-ce` - устанавливаем Docker

`sudo systemctl status docker` - проверяем работоспособность программы

Всё хорошо!

![image_2024-10-06_18-24-22](https://github.com/user-attachments/assets/0efa1b27-76cd-4ab5-8255-02d8abf6e7c2)

`docker run hello-world` - проверяем доступ к образам Docker

С нами поздоровались, значит, всё супер!

![IMG_9390](https://github.com/user-attachments/assets/fe63c78f-46fc-4794-a7cb-63527827c2e1)

## "Bad" Dockerfile
![IMG_9391](https://github.com/user-attachments/assets/6c452e40-1917-4160-ab08-4c5d511bdea9)

Что же такого "bad" в этом файле?

1. `FROM ubuntu:latest`
   
   Тег latest всегда указывает на последнюю версию доступного образа Ubuntu, но если базовый образ обновится, то написанный Dockerfile может перестать работать: появятся проблемы с совместимостью и непрезсказуемое поведение в работе с контейнерами.
   
2. `RUN apt-get update`

   `RUN apt-get install bash`

   Так размножать инструкции нельзя, так как из-за этого создаются лишние слои, что приводит к увеличению размера образа. Нам здесь это не нужно.
   
4. `отсутствие WORKDIR`
   
   Инструкция WORKDIR устанавливает рабочий каталог контейнера, а последующие команды наследуют привязку WORKDIR. Лучше сохранять все исходные файлы в отдельной папке в корневом каталоге, чем размещать их там же, где находятся системные файлы. Это снижает риск случайного повреждения образа при удалении.

## "Good" Dockerfile
![IMG_9392](https://github.com/user-attachments/assets/8d00bf7f-2b54-4c22-b84d-b8d3a095f69d)

Что стало "good"?

1. `FROM ubuntu:22.04`
   
   Мы изменили базовый образ на определенную версию (Ubuntu 22.04), и теперь он не сможет обновиться самостоятельно.
   
2. `RUN apt-get update && apt-get install bash`

   Здесь мы избавились от лишних слоев, создаваемых еще одной инструкцией RUN, и теперь всё указано в одном месте.
   
3. `WORKDIR /lab-2`
   
   Добавили рабочий каталог, тем самым избавившись от случайных рисков и добавив ясности и прозрачности (куда класть файлы, чтобы они не потерялись).


## "Bad Guys" в контейнерах
![image](https://github.com/user-attachments/assets/6c825a92-134d-482d-aa14-755bf525a610)

1. Отсутствие мониторинга контейнеров
Проблема: Запуск контейнеров без мониторинга их состояния и ресурсов (CPU, память, сеть) может привести к неожиданным проблемам. Например, если контейнер начинает потреблять слишком много ресурсов, это может вызвать деградацию производительности на хосте или даже привести к отказу всего сервера. Без системы мониторинга сложно заранее выявить такие ситуации.
Реальный риск: Если контейнер выходит из строя или превышает лимиты, это может привести к проблемам как внутри контейнера, так и с другими контейнерами, запущенными на том же хосте. Например, контейнер с базой данных может "зависнуть", из-за чего веб-приложение, зависящее от этой базы, тоже перестанет работать.
Рекомендация: Использовать инструменты мониторинга контейнеров, такие как Prometheus, Grafana, или встроенные инструменты в Docker и Kubernetes для отслеживания метрик контейнеров и системных ресурсов.

2. Неиспользование ограничений по ресурсам (CPU и память)
Проблема: Запуск контейнеров без установленных лимитов на использование процессора и памяти может привести к тому, что один контейнер начнет потреблять слишком много ресурсов, забирая их у других процессов на хосте. Это может привести к проблемам с производительностью всей системы.
Реальный риск: Без ограничений контейнер может "съесть" все доступные ресурсы, оставив хост-систему или другие контейнеры без необходимых ресурсов для работы. Это особенно критично на продакшн-серверах с большим количеством микросервисов.
Рекомендация: Устанавливать ограничения на ресурсы контейнеров при их запуске с помощью флагов --memory и --cpus. Например, docker run --memory=512m --cpus=1 ограничивает контейнер до 512 MB ОЗУ и одного процессорного ядра.

1. Игнорирование логов контейнеров
Проблема: Неуправляемое накопление логов внутри контейнеров может быстро занять большое количество дискового пространства на хосте. По умолчанию Docker хранит логи контейнеров в формате JSON, и если их размер не ограничен, файлы могут вырасти до огромных размеров, особенно при высоком уровне логирования.
Реальный риск: Если логи заполнят дисковое пространство на хосте, это может привести к сбоям как самого контейнера, так и других сервисов, запущенных на этом хосте. Кроме того, отсутствие эффективной стратегии управления логами затрудняет диагностику проблем в случае аварийных ситуаций.
Рекомендация: Настраивать ротацию и лимитирование логов с помощью драйверов логирования Docker. Например, параметр --log-opt max-size=10m --log-opt max-file=3 при запуске контейнера ограничит размер лог-файлов до 10 MB и сохранит не более трёх файлов.

2. Неправильное использование сетей (открытые порты)
Проблема: Открытие всех портов контейнера наружу без необходимости может привести к серьезным проблемам с безопасностью. Это даёт возможность неавторизованным пользователям взаимодействовать с контейнерами напрямую, если хост имеет публичный IP. Например, если база данных внутри контейнера слушает открытый порт, то она становится доступной извне, что увеличивает риск атак.
Реальный риск: Открытые порты могут быть использованы для проникновения злоумышленников в контейнеры или для атак, таких как DDoS или попытки подбора паролей.
Рекомендация: Открывать только необходимые порты контейнера и использовать параметры сети Docker для управления доступом. Например, можно запускать контейнеры с сетью типа bridge, чтобы они были изолированы друг от друга, и использовать только нужные порты с флагом -p для привязки конкретных портов к хосту.
